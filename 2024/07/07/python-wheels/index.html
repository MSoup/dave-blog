<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="This post is a summary of some reading I did on Python wheels. BackgroundWhen I was building a project on Lambda, I had a small hiccup where my dependencies worked locally, but on my lambda environmen">
<meta property="og:type" content="article">
<meta property="og:title" content="Python Wheels with AWS lambda">
<meta property="og:url" content="https://cloudsoup.net/2024/07/07/python-wheels/index.html">
<meta property="og:site_name" content="MajesticSoup">
<meta property="og:description" content="This post is a summary of some reading I did on Python wheels. BackgroundWhen I was building a project on Lambda, I had a small hiccup where my dependencies worked locally, but on my lambda environmen">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2024-07-07T07:36:26.000Z">
<meta property="article:modified_time" content="2026-02-08T03:53:15.294Z">
<meta property="article:author" content="Dave">
<meta property="article:tag" content="aws">
<meta property="article:tag" content="lambda">
<meta property="article:tag" content="python">
<meta property="article:tag" content="wheels">
<meta name="twitter:card" content="summary">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>Python Wheels with AWS lambda</title>
    <!-- async scripts -->
    <!-- Google Analytics -->


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 7.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="https://github.com/MSoup">Projects</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/2026/02/08/python-concurrency/"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/2024/07/06/writing-good-commit-messages/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://cloudsoup.net/2024/07/07/python-wheels/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://cloudsoup.net/2024/07/07/python-wheels/&text=Python Wheels with AWS lambda"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://cloudsoup.net/2024/07/07/python-wheels/&title=Python Wheels with AWS lambda"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://cloudsoup.net/2024/07/07/python-wheels/&is_video=false&description=Python Wheels with AWS lambda"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Python Wheels with AWS lambda&body=Check out this article: https://cloudsoup.net/2024/07/07/python-wheels/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://cloudsoup.net/2024/07/07/python-wheels/&title=Python Wheels with AWS lambda"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://cloudsoup.net/2024/07/07/python-wheels/&title=Python Wheels with AWS lambda"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://cloudsoup.net/2024/07/07/python-wheels/&title=Python Wheels with AWS lambda"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://cloudsoup.net/2024/07/07/python-wheels/&title=Python Wheels with AWS lambda"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://cloudsoup.net/2024/07/07/python-wheels/&name=Python Wheels with AWS lambda&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://cloudsoup.net/2024/07/07/python-wheels/&t=Python Wheels with AWS lambda"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Background"><span class="toc-number">1.</span> <span class="toc-text">Background</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#What-are-Python-Wheels"><span class="toc-number">2.</span> <span class="toc-text">What are Python Wheels?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Why-Use-Wheels"><span class="toc-number">3.</span> <span class="toc-text">Why Use Wheels?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Caveats-When-Building-Lambdas"><span class="toc-number">4.</span> <span class="toc-text">Caveats When Building Lambdas</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Ensure-the-correct-platform"><span class="toc-number">4.1.</span> <span class="toc-text">Ensure the correct platform</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Ensure-no-environment-mismatch"><span class="toc-number">4.2.</span> <span class="toc-text">Ensure no environment mismatch</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Lambda-Layers"><span class="toc-number">4.3.</span> <span class="toc-text">Lambda Layers</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Conclusion"><span class="toc-number">5.</span> <span class="toc-text">Conclusion</span></a></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        Python Wheels with AWS lambda
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">Dave</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2024-07-07T07:36:26.000Z" class="dt-published" itemprop="datePublished">2024-07-07</time>
        
      
    </div>


      

      
    <div class="article-tag">
        <i class="fa-solid fa-tag"></i>
        <a class="p-category" href="/tags/aws/" rel="tag">aws</a>, <a class="p-category" href="/tags/lambda/" rel="tag">lambda</a>, <a class="p-category" href="/tags/python/" rel="tag">python</a>, <a class="p-category" href="/tags/wheels/" rel="tag">wheels</a>
    </div>


    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <p>This post is a summary of some reading I did on Python wheels.</p>
<h2 id="Background"><a href="#Background" class="headerlink" title="Background"></a>Background</h2><p>When I was building a project on Lambda, I had a small hiccup where my dependencies worked locally, but on my lambda environment, I was getting a dependency error:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[ERROR] Runtime.ImportModuleError: Unable to import module &#x27;app&#x27;: No module named &#x27;pydantic_core._pydantic_core&#x27;</span><br><span class="line">Traceback (most recent call last):</span><br></pre></td></tr></table></figure>

<p>The issue happened to be that pip was installing the wheel for macos but lambda required a linux binary!</p>
<h2 id="What-are-Python-Wheels"><a href="#What-are-Python-Wheels" class="headerlink" title="What are Python Wheels?"></a>What are Python Wheels?</h2><p>Wheels are a standard format used today to distribute Python packages. They contain all the files needed for the library or application and are more secure than previous methods of distributing packages (such as running an arbitrary setup.py).</p>
<p>Python Wheels were introduced in 2012 in <a target="_blank" rel="noopener" href="https://peps.python.org/pep-0427/">PEP 427</a>. They have a .whl file extension, but are actually ZIP archives with a specific internal structure.</p>
<p>Wheels are broken down into tags, like:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;dist&#125;-&#123;version&#125;(-&#123;build&#125;)?-&#123;python&#125;-&#123;abi&#125;-&#123;platform&#125;.whl</span><br></pre></td></tr></table></figure>

<p>An example might be:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openai-1.30.1-py3-none-any.whl</span><br></pre></td></tr></table></figure>

<p>Breaking this down:</p>
<ul>
<li>openai is the package name</li>
<li>1.30.1 is the package version</li>
<li>py3 is the python tag. It supported any Python 3 version (although the dependencies pulled in might not! This is the most common source of dependency errors)</li>
<li>none is the ABI tag - ABI means <code>application binary interface</code></li>
<li>any is the platform tag - it will work on any platform</li>
</ul>
<h2 id="Why-Use-Wheels"><a href="#Why-Use-Wheels" class="headerlink" title="Why Use Wheels?"></a>Why Use Wheels?</h2><p>On the <a target="_blank" rel="noopener" href="https://pythonwheels.com/">Python Wheels Website</a>, some of the advantages of wheels are mentioned:</p>
<ul>
<li>Faster installation for pure Python and native C extension packages.</li>
<li>Avoids arbitrary code execution for installation. (Avoids setup.py)</li>
<li>Installation of a C extension does not require a compiler on Linux, Windows or macOS.</li>
<li>Allows better caching for testing and continuous integration.</li>
<li>Creates .pyc files as part of installation to ensure they match the Python interpreter used.</li>
<li>More consistent installs across platforms and machines.</li>
</ul>
<p>When installing from source distributions, sometimes you miss prerequisites needed to install from the source distribution.</p>
<p>When a wheel is available, an install command might look as simple as:</p>
<figure class="highlight bash"><figcaption><span>Installing a cross compatible wheel</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">% pip install openai</span><br><span class="line">Downloading openai-1.30.1-py3-none-any.whl (320 kB)</span><br><span class="line">   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 320.6/320.6 kB 1.1 MB/s eta 0:00:00</span><br><span class="line">Using cached anyio-4.3.0-py3-none-any.whl (85 kB)</span><br><span class="line">Using cached distro-1.9.0-py3-none-any.whl (20 kB)</span><br><span class="line">Using cached httpx-0.27.0-py3-none-any.whl (75 kB)</span><br><span class="line">Using cached httpcore-1.0.5-py3-none-any.whl (77 kB)</span><br><span class="line">Using cached pydantic-2.7.1-py3-none-any.whl (409 kB)</span><br><span class="line">Using cached pydantic_core-2.18.2-cp311-cp311-macosx_11_0_arm64.whl (1.8 MB)</span><br><span class="line">Using cached sniffio-1.3.1-py3-none-any.whl (10 kB)</span><br><span class="line">Using cached tqdm-4.66.4-py3-none-any.whl (78 kB)</span><br><span class="line">Using cached typing_extensions-4.11.0-py3-none-any.whl (34 kB)</span><br><span class="line">Using cached annotated_types-0.6.0-py3-none-any.whl (12 kB)</span><br><span class="line">Using cached idna-3.7-py3-none-any.whl (66 kB)</span><br><span class="line">Using cached certifi-2024.2.2-py3-none-any.whl (163 kB)</span><br><span class="line">Using cached h11-0.14.0-py3-none-any.whl (58 kB)</span><br><span class="line">Installing collected packages: typing-extensions, tqdm, sniffio, idna, h11, distro, certifi, annotated-types, pydantic-core, httpcore, anyio, pydantic, httpx, openai</span><br><span class="line">Successfully installed annotated-types-0.6.0 anyio-4.3.0 certifi-2024.2.2 distro-1.9.0 h11-0.14.0 httpcore-1.0.5 httpx-0.27.0 idna-3.7 openai-1.30.1 pydantic-2.7.1 pydantic-core-2.18.2 sniffio-1.3.1 tqdm-4.66.4 typing-extensions-4.11.0</span><br></pre></td></tr></table></figure>

<p>or</p>
<figure class="highlight bash"><figcaption><span>Installing a wheel based on my system, note the macosx_10_12_universal2</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">% pip install cryptography</span><br><span class="line"></span><br><span class="line">Collecting cryptography</span><br><span class="line">  Downloading cryptography-42.0.7-cp39-abi3-macosx_10_12_universal2.whl.metadata (5.3 kB)</span><br><span class="line">Collecting cffi&gt;=1.12 (from cryptography)</span><br><span class="line">  Using cached cffi-1.16.0-cp311-cp311-macosx_11_0_arm64.whl.metadata (1.5 kB)</span><br><span class="line">Collecting pycparser (from cffi&gt;=1.12-&gt;cryptography)</span><br><span class="line">  Downloading pycparser-2.22-py3-none-any.whl.metadata (943 bytes)</span><br><span class="line">Downloading cryptography-42.0.7-cp39-abi3-macosx_10_12_universal2.whl (5.9 MB)</span><br><span class="line">   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 5.9/5.9 MB 6.9 MB/s eta 0:00:00</span><br><span class="line">Using cached cffi-1.16.0-cp311-cp311-macosx_11_0_arm64.whl (176 kB)</span><br><span class="line">Downloading pycparser-2.22-py3-none-any.whl (117 kB)</span><br><span class="line">   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 117.6/117.6 kB 9.9 MB/s eta 0:00:00</span><br><span class="line">Installing collected packages: pycparser, cffi, cryptography</span><br><span class="line">Successfully installed cffi-1.16.0 cryptography-42.0.7 pycparser-2.22</span><br></pre></td></tr></table></figure>

<p>Without wheels, compiling <code>cryptography</code> yourself requires a C compiler, a Rust compiler, headers for Python (if you’re not using <code>pypy</code>), and headers for the OpenSSL and <code>libffi</code> libraries available on your system. The onus is on you to have everything in place when installing from a source distribution. The installation might look like:</p>
<figure class="highlight bash"><figcaption><span>Install dependencies manually before installing from a source distribution</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">// Alpine</span><br><span class="line">sudo apk add gcc musl-dev python3-dev libffi-dev openssl-dev cargo pkgconfig</span><br><span class="line"></span><br><span class="line">// Debian</span><br><span class="line">sudo apt-get install build-essential libssl-dev libffi-dev \</span><br><span class="line">    python3-dev cargo pkg-config</span><br><span class="line"></span><br><span class="line">// Fedora/RHEL/CentOS</span><br><span class="line">sudo dnf install redhat-rpm-config gcc libffi-devel python3-devel \</span><br><span class="line">    openssl-devel cargo pkg-config</span><br><span class="line"></span><br><span class="line">// MacOS</span><br><span class="line">brew install openssl@3 rust</span><br><span class="line"><span class="built_in">env</span> OPENSSL_DIR=<span class="string">&quot;<span class="subst">$(brew --prefix openssl@3)</span>&quot;</span> pip install cryptography</span><br></pre></td></tr></table></figure>

<h2 id="Caveats-When-Building-Lambdas"><a href="#Caveats-When-Building-Lambdas" class="headerlink" title="Caveats When Building Lambdas"></a>Caveats When Building Lambdas</h2><p>When building a <a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/lambda/latest/dg/python-package.html">lambda</a> locally to upload to AWS, pip assumes you want to use wheels targetted to your local system and installs the corresponding wheel for it. However, your system is not necessarily the same as the target system on AWS. Many libraries like <code>requests</code> have an <code>any</code> tag for the target platform, which means it should work. However, it’s entirely possible that your system packages the wrong wheels. This can lead to very cryptic errors, so be sure to watch your package manager (pip) installation logs, as sometimes, fetching the correct wheel requires specifying the correct platform.</p>
<h3 id="Ensure-the-correct-platform"><a href="#Ensure-the-correct-platform" class="headerlink" title="Ensure the correct platform"></a>Ensure the correct platform</h3><p>The solution is tucked away in the above AWS documentation:</p>
<blockquote>
<p>To make your deployment package compatible with Lambda, you install the wheel for Linux operating systems and your function’s instruction set architecture.<br>Some packages may only be available as source distributions. For these packages, you need to compile and build the C&#x2F;C++ components yourself.<br>To see what distributions are available for your required package, do the following:</p>
<ul>
<li>Search for the name of the package on the <a target="_blank" rel="noopener" href="https://pypi.org/">Python Package Index main page</a>.</li>
<li>Choose the version of the package you want to use.</li>
<li>Choose Download files.</li>
</ul>
</blockquote>
<p>The platform will usually be <code>manylinux_x_y_z</code>, where x and y are glibc major and minor versions supported (ie: <code>manylinux_2_24_xxx</code> should only work on distros using glibc 2.24+) and z is the architecture, like x86_64 or aarch64. Other forms of <code>manylinux</code> include manylinux1 (glibc 2.5 on x86_64 and i686 architectures), manylinux2010 (glibc 2.12 on x86_64 and i686), and manylinux2014 supports glibc 2.17 on x86_64, i686, aarch64, armv7l, ppc64, ppc64le, and s390x.</p>
<p>Caution: when using Amazon Linux 2023 as a base image to run container-based Lambda functions, <code>manylinux2010_x86_64</code> and <code>manylinux2014_x86_64</code> will fail. The version of glibc in the AL2023 base image has been upgraded to 2.34, from 2.26 that was bundled in the AL2 base image.</p>
<figure class="highlight bash"><figcaption><span>Note the manylinux2014_x86_64</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">pip install \</span><br><span class="line">--platform manylinux2014_x86_64 \</span><br><span class="line">--target=package \</span><br><span class="line">--implementation <span class="built_in">cp</span> \</span><br><span class="line">--python-version 3.x \</span><br><span class="line">--only-binary=:all: --upgrade \</span><br><span class="line">&lt;package_name&gt;</span><br></pre></td></tr></table></figure>

<p>For arm64</p>
<figure class="highlight bash"><figcaption><span>Note the manylinux2014_aarch64</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">pip install \</span><br><span class="line">--platform manylinux2014_aarch64 \</span><br><span class="line">--target=package \</span><br><span class="line">--implementation <span class="built_in">cp</span> \</span><br><span class="line">--python-version 3.x \</span><br><span class="line">--only-binary=:all: --upgrade \</span><br><span class="line">&lt;package_name&gt;</span><br></pre></td></tr></table></figure>

<h3 id="Ensure-no-environment-mismatch"><a href="#Ensure-no-environment-mismatch" class="headerlink" title="Ensure no environment mismatch"></a>Ensure no environment mismatch</h3><p>If you are running python 3.12 and your lambda is on 3.9, you may unintentionally pull the 3.12 wheel, leading to the wrong dependency in your lambda environment.</p>
<h3 id="Lambda-Layers"><a href="#Lambda-Layers" class="headerlink" title="Lambda Layers"></a>Lambda Layers</h3><p>For <a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/lambda/latest/dg/python-layers.html">lambda layers</a>, AWS explicitly states:</p>
<p>Because Lambda functions run on Amazon Linux, your layer content must be able to compile and build in a Linux environment.</p>
<p>In Python, most packages are available as wheels (.whl files) in addition to the source distribution. Each wheel is a type of built distribution that supports a specific combination of Python versions, operating systems, and machine instruction sets.</p>
<p>Wheels are useful for ensuring that your layer is compatible with Amazon Linux. When you download your dependencies, download the universal wheel if possible. (By default, pip installs the universal wheel if one is available.) The universal wheel contains any as the platform tag, indicating that it’s compatible with all platforms, including Amazon Linux.</p>
<p>However…</p>
<p>Not all Python packages are distributed as universal wheels. For example, numpy has multiple wheel distributions, each supporting a different set of platforms. For such packages, download the manylinux distribution to ensure compatibility with Amazon Linux. For detailed instructions about how to package such layers, see <a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/lambda/latest/dg/python-layers.html#python-layer-manylinux">Working with manylinux wheel distributions</a>.</p>
<p>In rare cases, a Python package might not be available as a wheel. If only the source distribution (sdist) exists, then we recommend installing and packaging your dependencies in a Docker environment based on the Amazon Linux 2023 base container image. We also recommend this approach if you want to include your own custom libraries written in other languages such as C&#x2F;C++. This approach mimics the Lambda execution environment in Docker, and ensures that your non-Python package dependencies are compatible with Amazon Linux.</p>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>Understanding wheels will make your life easier, especially in the cases of troubleshooting Python dependencies.</p>
<p>If you are troubleshooting dependencies on lambda and are still stuck, <a target="_blank" rel="noopener" href="https://github.com/pydantic/pydantic/issues/6557">this thread</a> may also give you some hints.</p>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">Home</a></li>
        
          <li><a href="/about/">About</a></li>
        
          <li><a href="/archives/">Writing</a></li>
        
          <li><a target="_blank" rel="noopener" href="https://github.com/MSoup">Projects</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Background"><span class="toc-number">1.</span> <span class="toc-text">Background</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#What-are-Python-Wheels"><span class="toc-number">2.</span> <span class="toc-text">What are Python Wheels?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Why-Use-Wheels"><span class="toc-number">3.</span> <span class="toc-text">Why Use Wheels?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Caveats-When-Building-Lambdas"><span class="toc-number">4.</span> <span class="toc-text">Caveats When Building Lambdas</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Ensure-the-correct-platform"><span class="toc-number">4.1.</span> <span class="toc-text">Ensure the correct platform</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Ensure-no-environment-mismatch"><span class="toc-number">4.2.</span> <span class="toc-text">Ensure no environment mismatch</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Lambda-Layers"><span class="toc-number">4.3.</span> <span class="toc-text">Lambda Layers</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Conclusion"><span class="toc-number">5.</span> <span class="toc-text">Conclusion</span></a></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://cloudsoup.net/2024/07/07/python-wheels/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://cloudsoup.net/2024/07/07/python-wheels/&text=Python Wheels with AWS lambda"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://cloudsoup.net/2024/07/07/python-wheels/&title=Python Wheels with AWS lambda"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://cloudsoup.net/2024/07/07/python-wheels/&is_video=false&description=Python Wheels with AWS lambda"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Python Wheels with AWS lambda&body=Check out this article: https://cloudsoup.net/2024/07/07/python-wheels/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://cloudsoup.net/2024/07/07/python-wheels/&title=Python Wheels with AWS lambda"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://cloudsoup.net/2024/07/07/python-wheels/&title=Python Wheels with AWS lambda"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://cloudsoup.net/2024/07/07/python-wheels/&title=Python Wheels with AWS lambda"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://cloudsoup.net/2024/07/07/python-wheels/&title=Python Wheels with AWS lambda"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://cloudsoup.net/2024/07/07/python-wheels/&name=Python Wheels with AWS lambda&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://cloudsoup.net/2024/07/07/python-wheels/&t=Python Wheels with AWS lambda"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2024-2026
    Dave
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="https://github.com/MSoup">Projects</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
